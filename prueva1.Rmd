---
title: "Prueba"
author: "Sofia"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    includes:
      in_header: preamble.tex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, echo=TRUE)
library(tidyverse)
library(readr)
library(dplyr)
library(knitr)
library(kableExtra)
library(plotly)
library(e1071)

library(extrafont)
loadfonts(device = "win")

SP <- read.csv("C:/Users/PC/OneDrive/Documents/StudentsPerformance1.csv")
```

# Analisis Bivariante

Para examinar el nivel de correlación entre las variables "Nivel Educativo de los padres" y "Almuerzo" en comparación a la variable "Desempeño" lo primero que haremos sera crear dos tablas bivariantes, una con "Nivel Educativo de los padres" y "Desempeño" y la otra con "Almuerzo" y "Nivel Educativo de los padres", para hacer esto primero agrupamos a la variable desempeño, lo cual fue hecho calculando el rango de ésta variable ($r = Valor_{maximo} - Valor_{minimo}$), seguido de la determinación del número de clases utilizando el criterio de Dixon ($k = 1 + \log_{10}(n)$, Donde $n$ es el total de observaciones de la base de datos), posteriormente se calcula el intervalo de amplitud ($IC = \frac{r}{k}$, donde $r$ es el rango y $k$ es la cantidad de clases redondedo a un número entero) y por ultimo se calculan  los lmites de clase ($LI_1 = Valor_ {minimo}$, $LS_i = LI_i + IC$, etc) y finalmente se agrupan los datos de acurdo a las clases de las variables. 

```{r Intervalos de "desempeño", echo=FALSE}
# crear intervalos para Desempeño
SP$Desempeño_Intervalos <- cut(SP$Desempeño, 
                               breaks = c(9, 32, 55, 78, 100), 
                               right = FALSE,
                               include.lowest = TRUE,
                               labels = c("[9,32]", "[32,55]", "[55,78]", "[78,100]"))

```

```{r tabla1 , echo=FALSE}
# crear la tabla de frecuencias bivariante a
tabla_frecuenciasa <- table(SP$parental_level_of_education, SP$Desempeño_Intervalos)
tabla_frecuenciasa <- addmargins(tabla_frecuenciasa)   # Añadir las frecuencias marginales
tabla_frecuenciasa_df <- as.data.frame.matrix(tabla_frecuenciasa) # Convertir la tabla a un data frame para formatearla

# Crear la tabla formateada
kable(tabla_frecuenciasa_df, caption = "Desempeño En Comparación al Nivel Educativo de los Padres", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))

# Reducir el espacio entre las tablas
invisible(capture.output(
  cat("\\vspace{-10mm}")
))
```

En la tabla 1 se observa que los estudiantes cuyos padres tienen un nivel educativo más alto (como "bachelor's degree" y "master's degree") tienden a tener (en proporción) un mayor número de estudiantes en los intervalos de desempeño más altos ([78,100]), por ejemplo, en el intervalo [78,100], los estudiantes con padres que tienen un "master's degree" tienen 24 estudiantes, mientras que los estudiantes con padres que tienen un "high school" tienen solo 28 estudiantes, a pesar de que el grupo de "high school" es mucho más grande (196 estudiantes en total) que el grupo de "master's degree" (con 59 estudiantes en total). Sin embargo busquemos visualizar esto de mejor manera mediante cualtiles.


```{r cuartiles, echo=FALSE}
# Calcular cuartiles por nivel educativo de los padres
cuartiles <- SP %>%
  group_by(parental_level_of_education) %>%
  summarise(
    Q1 = round(quantile(Desempeño, 0.25), 2),
    Q2 = round(quantile(Desempeño, 0.50), 2), 
    Q3 = round(quantile(Desempeño, 0.75), 2))

# Mostrar 
kable(cuartiles, caption = "Cuartiles del Desempeño por Nivel Educativo de los Padres", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

En la tabla 2 se observa que los estudiantes cuyos padres tienen un nivel educativo más alto (como "bachelor's degree" y "master's degree") tienen cuartiles más altos en comparación con aquellos cuyos padres tienen un nivel educativo más bajo (como "high school"), por ejemplo, el Q3 (tercer cuartil) para "master's degree" es 85.50, mientras que para "high school" es 72.67. Esto indica que el 75% de los estudiantes con padres que tienen un "master's degree" tienen un desempeño superior a 85.50, mientras que el 75% de los estudiantes con padres que tienen un "high school" tienen un desempeño superior a 72.67.Todo esto se puede visualizar mucho mejor en el grafico de cajas "Desempeño en función del Nivel Educativo de los Padres".

```{r grafico1, echo=FALSE}
# Grafico de cajas
ggplot(SP, aes(
  x = parental_level_of_education, 
  y = Desempeño, 
  fill = parental_level_of_education)) + 
  geom_boxplot() + 
  stat_summary(fun = "mean", geom = "point") + labs(
    title = "Desempeño en función del Nivel Educativo de los Padres", 
    x = "Nivel Educativo de los Padres", 
    y = "Desempeño",
    fill = "") + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_blank(),
    legend.position = "bottom",
    legend.title = element_text(hjust = 0.5))
```

```{r caculos basicos, echo=FALSE}
estadisticos_basicos <- SP %>%
  group_by(parental_level_of_education) %>%
  summarise(
    Media = mean(Desempeño),
    D.Estandar = sd(Desempeño),
    C.Variacion = (D.Estandar / Media) * 100,
    Asimetria = skewness(Desempeño),
    Kurtosis = kurtosis(Desempeño)
  )
# Mostrar
kable(estadisticos_basicos, caption = "Estadisticas Basicas del Desempeño por Nivel Educativo de los Padres", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```



```{r tabla2 , echo=FALSE}
# Crear la tabla de frecuencias bivariante b
tabla_frecuenciasb <- table(SP$lunch, SP$Desempeño_Intervalos)
tabla_frecuenciasb <- addmargins(tabla_frecuenciasb)   # Añadir las frecuencias marginales
tabla_frecuenciasb_df <- as.data.frame.matrix(tabla_frecuenciasb) # Convertir la tabla a un data frame para formatearla

# Mostrar
kable(tabla_frecuenciasb_df, caption = "Desempeño En Comparación al Tipo de Almuerzo", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

```{r curtosis2, echo=FALSE}
# Calcular cuartiles por nivel educativo de los padres
cuartiles2 <- SP %>%
  group_by(lunch) %>%
  summarise(
    Q1 = round(quantile(Desempeño, 0.25), 2),
    Q2 = round(quantile(Desempeño, 0.50), 2), 
    Q3 = round(quantile(Desempeño, 0.75), 2))

# Mostrar 
kable(cuartiles2, caption = "Cuartiles del Desempeño Calidad de Almuerzo", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

```{r grafico2, echo=FALSE, fig.width = 5, fig.height = 5}
# Grafico de cajas
ggplot(SP, aes(x = lunch, y = Desempeño, fill = lunch)) + 
  geom_boxplot() + 
  stat_summary(fun = "mean", geom = "point") + labs(
    title = "Desempeño en función de la Calidad de los Almuerzos", 
    x = "Almuerzo", 
    y = "Desempeño",
    fill = "") + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_blank(),
    legend.position = "bottom",
    legend.title = element_text(hjust = 0.5))
```

```{r calculos basicos2, echo=FALSE}
estadisticos_basicos2 <- SP %>%
  group_by(lunch) %>%
  summarise(
    Media = mean(Desempeño),
    D.Estandar = sd(Desempeño),
    C.Variacion = (D.Estandar / Media) * 100,
    Asimetria = skewness(Desempeño),
    Kurtosis = kurtosis(Desempeño)
  )
# Mostrar
kable(estadisticos_basicos2, caption = "Estadisticas Basicas del Desempeño por Calidad de Almuerzo", format = "latex", booktabs = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position"))
```

# Comparación de las Tres Variables en Conjunto

```{r grafico3, echo=FALSE}
# Grafico de cajas
ggplot(SP, aes(x = parental_level_of_education, y = Desempeño, fill = parental_level_of_education, colour = lunch)) + 
  geom_boxplot() + 
  stat_summary(fun = "mean", geom = "point", position = position_dodge(width = 0.75)) + labs(
    title = "Desempeño en función del Nivel Educativo de los Padres", 
    x = "Nivel Educativo de los Padres", 
    y = "Desempeño",
    fill = "",  
    colour = "") + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_blank(),
    legend.position = "bottom",
    legend.title = element_text(hjust = 0.5)) + 
 scale_colour_manual(values = c("standard" = "blue", "free/reduced" = "red"))           
```

