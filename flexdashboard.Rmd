---
title: "Dashboard del estudio del desempeño academico de los estudiantes"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(highcharter)
library(gt)
library(htmltools)
library(viridis)
library(knitr)
library(ggplot2)
library(readxl)
library(dplyr)
library(plotly)
library(DT)

SP <- read_excel("StudentsPerformance G5-G6.xlsx")


knitr::opts_chunk$set(echo = TRUE)

#Lectura de base de datos



#Seleccion de columnas (variables) a estudiar
variables <-select(SP, "parental level of education", "lunch", "math score", "reading score", "writing score")
variables <- variables %>%
  mutate(Desempeño = round((`math score` + `reading score` + `writing score`) / 3,2 ))

notas <- select(SP, "math score", "reading score", "writing score")

notas <- notas %>%
  mutate(Desempeño = round((`math score` + `reading score` + `writing score`) / 3,2 ))
```

# Tabla de datos a analizar
===
## column {data-width="1200"}

### Tabla de datos 
```{r, echo = FALSE}
datatable(variables, 
          options = list(
            pageLength = 10,  
            scrollX = TRUE,   
            autoWidth = TRUE),
              )
          rownames = FALSE   
          filter = "top"
```


# Distribucion de las variables cualitativas 

## column {data-width="600"}

### DISTRIBUCION DE LA VARIABLE PARENTAL LEVEL OF EDUCATION

```{r, echo = FALSE}
#Graficos de las Distribuciones de las variables cualitativas

Cantidad_parental_level <- variables %>%
  group_by(`parental level of education`) %>%
  summarise(
    Cantidad1 = n(),
    Proporcion1 = round((n() / nrow(variables)) * 100, 2)
  )
ggplotly(ggplot(Cantidad_parental_level, aes(x = `parental level of education`, y = Cantidad1, fill = `parental level of education`)) +
  geom_col() +
  labs(
    title = "Distribucion de la variable parental level of education",
    x = "Nivel de educacion parental",
    y = "Cantidad",
    fill = ""
  ) + theme_light() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(family = "serif"),
    legend.position = "bottom"
    )
)
```


## column {data-width="400"}

### DISTRIBUCION DE LA VARIABLE LUNCH

```{r, echo = FALSE}
Cantidad_lunch <- variables %>%
  group_by(`lunch`) %>%
  summarise(
    Cantidad2 = n(),
    Proporcion2 = round((n() / nrow(variables)) * 100, 2)
  )

ggplotly(
  ggplot(Cantidad_lunch, aes(x = `lunch`, y = Cantidad2, fill = `lunch`)) +
  geom_col() +
  labs(
    title = "Distribucion de la variable lunch",
    x = "lunch",
    y = "Cantidad",
    fill = ""
  ) + theme_light() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    text = element_text(family = "serif"),
    legend.position = "bottom"
    )
)
```




# Graficos de caja

## column {data-width="500"}

### GRAFICO DE CAJA 1
```{r, echo = FALSE}
ggplotly(
  ggplot(variables, aes(x = `lunch`, y = `Desempeño`, fill = `lunch`)) + 
  geom_boxplot() + 
  stat_summary(fun = "mean", geom = "point") + labs(
    title = "Desempeño en función de la Calidad de los Almuerzos", 
    x = "Almuerzo", 
    y = "Desempeño",
    fill = "") + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_blank(),
    legend.position = "bottom",
    legend.title = element_text(hjust = 0.5))
)
```


## column {data-width="500"}

### GRAFICO DE CAJA 2
```{r, echo = FALSE}
ggplotly(
  ggplot(variables, aes(
  x = `parental level of education`, 
  y = Desempeño, 
  fill = `parental level of education`)) + 
  geom_boxplot() + 
  stat_summary(fun = "mean", geom = "point") + labs(
    title = "Desempeño en función del Nivel Educativo de los Padres", 
    x = "Nivel Educativo de los Padres", 
    y = "Desempeño",
    fill = "") + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5),
    axis.text.x = element_blank(),
    legend.position = "bottom",
    legend.title = element_text(hjust = 0.5))
)
```


# 3 variables en conjunto

## column {data-width="300"}

### Grafico del análisis de las 3 variables en conjunto
```{r, echo = FALSE}
ggplotly(
  ggplot(variables, aes(
    x = `parental level of education`, 
    y = Desempeño, 
    fill = lunch  # Usar "fill" para separar por "lunch"
  )) + 
  geom_boxplot(
    position = position_dodge(width = 0.8),  # Dodge para separar cajas
     alpha = 0.7) + stat_summary(
    fun = "mean", 
    geom = "point", 
    position = position_dodge(width = 0.8),  
    size = 2, 
    color = "black"
  ) + labs(
    title = "Desempeño en función del Nivel Educativo de los Padres y Tipo de Almuerzo", 
    x = "Nivel Educativo de los Padres", 
    y = "Desempeño",
    fill = "Tipo de Almuerzo") + theme_light() + theme(
    text = element_text(family = "serif"),
    plot.title = element_text(hjust = 0.5, size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1),  
    legend.position = "bottom") + scale_fill_manual(values = c("standard" = "#00BFC4", "free/reduced" = "#F8766D")))          
```




